# Expiration e Cache
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresDefault "access plus 1 month"
    ExpiresByType image/x-icon "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
</IfModule>

# Gzip Compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

RewriteEngine On
RewriteBase /

# 1. Redirect root to dist/index.html
RewriteRule ^$ dist/index.html [L]

# 2. Check if the request points to a file that exists in /dist/
# If request is /foo.css and /dist/foo.css exists, rewrite to /dist/foo.css
RewriteCond %{REQUEST_URI} !^/dist/
RewriteCond %{DOCUMENT_ROOT}/dist%{REQUEST_URI} -f
RewriteRule ^(.*)$ dist/$1 [L]

# 3. Clean URLs: Check if request + .html exists in /dist/
# If request is /servicos/conserto-iphone and /dist/servicos/conserto-iphone.html exists
RewriteCond %{REQUEST_URI} !^/dist/
RewriteCond %{DOCUMENT_ROOT}/dist%{REQUEST_URI}.html -f
RewriteRule ^(.*)$ dist/$1.html [L]

# 4. Check if request points to a directory in /dist/ that has index.html
# If request is /blog/ and /dist/blog/index.html exists
RewriteCond %{REQUEST_URI} !^/dist/
RewriteCond %{DOCUMENT_ROOT}/dist%{REQUEST_URI}/index.html -f
RewriteRule ^(.*)$ dist/$1/index.html [L]

# 5. Fallback for everything else (e.g. 404s handled by Astro or generic assets)
# Just define that anything starting with dist/ is served as is if it exists
# Otherwise let it pass through (which will likely 404 naturally)
